# Настройка Netlify для публикации статей

## Проблема
Ошибка: "Отсутствуют заголовки микросервиса оператора" (400) при публикации статей через CMS.

## Решение

### 1. Настройка Netlify Identity

1. Войдите в панель управления Netlify: https://app.netlify.com
2. Выберите ваш сайт (flamingoauto-site)
3. Перейдите в **Site settings** → **Identity**
4. Нажмите **Enable Identity**
5. **ВАЖНО**: Дождитесь полной активации (может занять 1-2 минуты)

### 2. Настройка Git Gateway

1. В разделе **Identity**, найдите **Services**
2. Нажмите **Enable Git Gateway**
3. Убедитесь, что выбрана правильная ветка: `main`
4. **КРИТИЧНО**: Проверьте, что статус показывает "Git Gateway enabled"

### 3. Настройка регистрации

1. В разделе **Identity** → **Settings and usage**
2. Установите **Registration preferences**: **Invite only**
3. Это обеспечит безопасность вашей CMS

### 4. Приглашение пользователей

1. В разделе **Identity**, нажмите **Invite users**
2. Введите email адрес администратора
3. Нажмите **Send**
4. **ОБЯЗАТЕЛЬНО**: Проверьте почту и перейдите по ссылке активации
5. Создайте надежный пароль для доступа к CMS
6. **Проверьте**: В списке пользователей статус должен быть "Confirmed"

### 5. Проверка настроек

После выполнения всех шагов:

1. Перейдите на `https://your-site.netlify.app/cms-diagnostic.html` (диагностическая страница)
2. Нажмите "Проверить аутентификацию"
3. Нажмите "Войти в систему" и войдите используя созданные учетные данные
4. Нажмите "Тест API" для проверки доступа к GitHub
5. Если все тесты пройдены, перейдите на `/admin/` для управления контентом

### 6. Использование Decap CMS (рекомендуется)

Для стабильной работы рекомендуется использовать стандартный Decap CMS:

1. Перейдите на `https://your-site.netlify.app/admin/`
2. Войдите в систему
3. Создайте новую запись в блоге
4. Заполните все обязательные поля
5. Сохраните как черновик или сразу опубликуйте

### 6. Переменные окружения (если необходимо)

Если у вас есть дополнительные интеграции, убедитесь что настроены:

1. **Site settings** → **Environment variables**
2. Добавьте необходимые переменные:
   - `TELEGRAM_BOT_TOKEN` (если используется)
   - `TELEGRAM_CHAT_ID` (если используется)

## Диагностика проблем

### Если ошибка сохраняется:

1. **Проверьте статус Identity**:
   - Должен быть "Enabled"
   - Git Gateway должен быть "Enabled"

2. **Проверьте права пользователя**:
   - Пользователь должен быть приглашен и активирован
   - Проверьте статус в разделе Identity → Users

3. **Проверьте настройки репозитория**:
   - В config.yml должен быть правильный репозиторий
   - Ветка должна быть `main`

4. **Очистите кеш браузера**:
   - Ctrl+F5 для полной перезагрузки
   - Или используйте режим инкогнито

### Логи для диагностики

1. Откройте консоль разработчика (F12)
2. Перейдите на вкладку **Network**
3. Попробуйте сохранить статью
4. Найдите запросы с ошибками 400/401/403
5. Проверьте заголовки запросов

## Тестирование

После настройки создайте тестовую статью:

```markdown
---
title: "Тестовая статья"
date: 2025-09-11T10:00:00.000Z
lang: ru
description: "Описание тестовой статьи"
---

# Заголовок тестовой статьи

Это тестовое содержимое для проверки работы CMS.
```

Если статья успешно сохраняется и публикуется, настройка выполнена корректно.

## Дополнительные ресурсы

- [Документация Netlify Identity](https://docs.netlify.com/visitor-access/identity/)
- [Документация Git Gateway](https://docs.netlify.com/visitor-access/git-gateway/)
- [Документация Decap CMS](https://decapcms.org/docs/netlify/)