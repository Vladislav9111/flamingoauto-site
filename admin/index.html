<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager - Flamingo Auto</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    .auth-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .auth-panel {
      background: white;
      padding: 3rem;
      border-radius: 12px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .auth-btn {
      background: #007bff;
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      margin: 1rem 0;
      transition: background 0.3s;
    }
    .auth-btn:hover {
      background: #0056b3;
    }
    .loading {
      display: none;
      color: #666;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <!-- Overlay –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div id="auth-overlay" class="auth-overlay">
    <div class="auth-panel">
      <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
      <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ CMS –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
      <button id="login-btn" class="auth-btn">üîë –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Netlify</button>
      <div id="loading" class="loading">
        <p>‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º CMS...</p>
      </div>
      <div style="margin-top: 2rem; font-size: 0.9rem; color: #666;">
        <p>–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</p>
        <p>1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Netlify Identity</p>
        <p>2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø</p>
        <p>3. <a href="/admin.html" style="color: #007bff;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –∞–¥–º–∏–Ω–∫—É</a></p>
      </div>
    </div>
  </div>

  <!-- CMS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div id="nc-root"></div>
  
  <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <script>
    const authOverlay = document.getElementById('auth-overlay');
    const loginBtn = document.getElementById('login-btn');
    const loading = document.getElementById('loading');
    
    let isAuthenticated = false;

    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è overlay
    function hideAuthOverlay() {
      authOverlay.style.display = 'none';
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ loading
    function showLoading() {
      loginBtn.style.display = 'none';
      loading.style.display = 'block';
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Netlify Identity
    if (window.netlifyIdentity) {
      console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Netlify Identity...');
      
      window.netlifyIdentity.on("init", user => {
        console.log('‚úÖ Netlify Identity –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user ? user.email : '–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        
        if (user) {
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
          isAuthenticated = true;
          showLoading();
          setTimeout(hideAuthOverlay, 2000);
        } else {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞
          authOverlay.style.display = 'flex';
        }
      });

      window.netlifyIdentity.on("login", user => {
        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:', user.email);
        isAuthenticated = true;
        showLoading();
        
        // –ü—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º overlay –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º CMS
        setTimeout(() => {
          hideAuthOverlay();
        }, 1500);
      });

      window.netlifyIdentity.on("logout", () => {
        console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª');
        isAuthenticated = false;
        document.location.href = "/";
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Identity
      try {
        window.netlifyIdentity.init();
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Netlify Identity:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      }
    } else {
      console.error('‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
      alert('–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞
    loginBtn.addEventListener('click', function() {
      console.log('üîÑ –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
      
      if (window.netlifyIdentity) {
        try {
          window.netlifyIdentity.open();
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
          alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
      } else {
        alert('–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –≥–æ—Ç–æ–≤–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      }
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CMS
    setTimeout(() => {
      if (isAuthenticated && window.CMS) {
        console.log('‚úÖ CMS –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
        hideAuthOverlay();
      } else if (isAuthenticated) {
        console.log('‚ö†Ô∏è CMS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
      }
    }, 5000);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    window.addEventListener('error', function(event) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', event.error);
      if (event.message && event.message.includes('CMS')) {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CMS. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      }
    });
  </script>
</body>
</html>