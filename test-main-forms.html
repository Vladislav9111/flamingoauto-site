<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–æ—Ä–º —Å–∞–π—Ç–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .result.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .result.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .result.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–æ—Ä–º —Å–∞–π—Ç–∞</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Ñ–æ—Ä–º —Å –≥–ª–∞–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü index.html –∏ ru.html</p>
        
        <button class="test-button" onclick="testScriptJsLoading()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É script.js</button>
        <div id="scriptResult" class="result" style="display: none;"></div>
        
        <button class="test-button" onclick="testFormElements()">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã</button>
        <div id="elementsResult" class="result" style="display: none;"></div>
        
        <button class="test-button" onclick="testFormSubmission()">3. –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã</button>
        <div id="submissionResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>üîß –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–∫–æ–ø–∏—è —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)</h2>
        
        <form id="car-form" novalidate>
            <h3>–î–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ</h3>
            <div class="form-group">
                <label for="reg-number">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä*</label>
                <input type="text" id="reg-number" name="reg-number" required placeholder="123 ABC" value="TEST123">
            </div>
            <div class="form-group">
                <label for="make">–ú–∞—Ä–∫–∞</label>
                <input type="text" id="make" name="make" placeholder="BMW" value="BMW">
            </div>
            <div class="form-group">
                <label for="model">–ú–æ–¥–µ–ª—å</label>
                <input type="text" id="model" name="model" placeholder="X5" value="X5">
            </div>
            <div class="form-group">
                <label for="year">–ì–æ–¥</label>
                <input type="number" id="year" name="year" placeholder="2020" value="2020">
            </div>
            <div class="form-group">
                <label for="mileage">–ü—Ä–æ–±–µ–≥</label>
                <input type="number" id="mileage" name="mileage" placeholder="50000" value="50000">
            </div>
            <div class="form-group">
                <label for="transmission">–ö–ü–ü</label>
                <select id="transmission" name="transmission">
                    <option value="automatic" selected>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è</option>
                    <option value="manual">–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è</option>
                </select>
            </div>
            <div class="form-group">
                <label for="engine">–î–≤–∏–≥–∞—Ç–µ–ª—å</label>
                <input type="text" id="engine" name="engine" placeholder="2.0 TDI" value="2.0 TDI">
            </div>
            <div class="form-group">
                <label for="price">–ñ–µ–ª–∞–µ–º–∞—è —Ü–µ–Ω–∞ (‚Ç¨)</label>
                <input type="text" id="price" name="price" placeholder="‚Ç¨" value="25000">
            </div>
            <div class="form-group">
                <label for="photos">–§–æ—Ç–æ (–¥–æ 6)</label>
                <input type="file" id="photos" name="photos" multiple accept="image/*">
                <small id="photo-error" class="error-message"></small>
            </div>
            
            <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <div class="form-group">
                <label for="name">–ò–º—è*</label>
                <input type="text" id="name" name="name" required placeholder="–í–∞—à–µ –∏–º—è" value="–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á">
            </div>
            <div class="form-group">
                <label for="email">Email*</label>
                <input type="email" id="email" name="email" required placeholder="email@example.com" value="test@example.com">
            </div>
            <div class="form-group">
                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω*</label>
                <input type="tel" id="phone" name="phone" required placeholder="+372 1234567" value="+372 1234567">
            </div>
            <div class="form-group">
                <label for="city">–ì–æ—Ä–æ–¥*</label>
                <input type="text" id="city" name="city" required placeholder="Tallinn" value="–¢–∞–ª–ª–∏–Ω–Ω">
            </div>
            <div class="form-group">
                <label for="note">–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                <textarea id="note" name="note" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶">–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã —Å–∞–π—Ç–∞</textarea>
            </div>
            
            <button type="submit" class="test-button">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
        
        <div id="formResult" class="result" style="display: none;"></div>
    </div>

    <!-- Popup –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
    <div id="popup" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; max-width: 400px;">
            <span class="close-btn" style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;">&times;</span>
            <p>–í–∞—à–∞ –∞–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</p>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }

        function testScriptJsLoading() {
            showResult('scriptResult', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É script.js...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã script.js –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                const form = document.getElementById('car-form');
                const photoInput = document.getElementById('photos');
                
                if (!form) {
                    throw new Error('–§–æ—Ä–º–∞ car-form –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                if (!photoInput) {
                    throw new Error('–ü–æ–ª–µ photos –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã
                const hasSubmitHandler = form.onsubmit !== null || form.addEventListener;
                
                showResult('scriptResult', 
                    `‚úÖ script.js –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n` +
                    `- –§–æ—Ä–º–∞ –Ω–∞–π–¥–µ–Ω–∞: ${!!form}\n` +
                    `- –ü–æ–ª–µ —Ñ–æ—Ç–æ –Ω–∞–π–¥–µ–Ω–æ: ${!!photoInput}\n` +
                    `- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π: ${hasSubmitHandler}`, 
                    'success'
                );
                
            } catch (error) {
                showResult('scriptResult', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ script.js: ${error.message}`, 'error');
            }
        }

        function testFormElements() {
            showResult('elementsResult', '–ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã...', 'info');
            
            try {
                const form = document.getElementById('car-form');
                const requiredFields = ['reg-number', 'name', 'email', 'phone', 'city'];
                const allFields = ['reg-number', 'make', 'model', 'year', 'mileage', 'transmission', 'engine', 'price', 'name', 'email', 'phone', 'city', 'note', 'photos'];
                
                let report = 'üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã:\n\n';
                
                for (const fieldName of allFields) {
                    const field = form.elements[fieldName];
                    const isRequired = requiredFields.includes(fieldName);
                    const hasValue = field && field.value && field.value.trim() !== '';
                    
                    report += `${field ? '‚úÖ' : '‚ùå'} ${fieldName}: ${field ? '–Ω–∞–π–¥–µ–Ω–æ' : '–ù–ï –ù–ê–ô–î–ï–ù–û'}`;
                    if (field && isRequired) {
                        report += ` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ${hasValue ? ', –∑–∞–ø–æ–ª–Ω–µ–Ω–æ' : ', –ü–£–°–¢–û–ï'})`;
                    }
                    report += '\n';
                }
                
                showResult('elementsResult', report, 'success');
                
            } catch (error) {
                showResult('elementsResult', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${error.message}`, 'error');
            }
        }

        function testFormSubmission() {
            showResult('submissionResult', '–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã...', 'info');
            
            try {
                const form = document.getElementById('car-form');
                const photoInput = document.getElementById('photos');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const formData = new FormData();
                const formElements = form.elements;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
                formData.append('regNumber', formElements['reg-number'].value);
                formData.append('make', formElements['make'].value);
                formData.append('model', formElements['model'].value);
                formData.append('year', formElements['year'].value);
                formData.append('mileage', formElements['mileage'].value);
                formData.append('transmission', formElements['transmission'].value);
                formData.append('engine', formElements['engine'].value);
                formData.append('price', formElements['price'].value);
                formData.append('name', formElements['name'].value);
                formData.append('email', formElements['email'].value);
                formData.append('phone', formElements['phone'].value);
                formData.append('city', formElements['city'].value);
                formData.append('note', formElements['note'].value);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ
                const files = photoInput.files;
                for (let i = 0; i < files.length && i < 6; i++) {
                    formData.append(`photo${i}`, files[i]);
                }
                formData.append('photoCount', files.length.toString());
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
                fetch('/.netlify/functions/send-telegram', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        showResult('submissionResult', 
                            `‚úÖ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n` +
                            `–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: ${files.length}\n` +
                            `–û—Ç–≤–µ—Ç: ${JSON.stringify(result, null, 2)}`, 
                            'success'
                        );
                    } else {
                        showResult('submissionResult', 
                            `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${result.error}\n` +
                            `–î–µ—Ç–∞–ª–∏: ${JSON.stringify(result, null, 2)}`, 
                            'error'
                        );
                    }
                })
                .catch(error => {
                    showResult('submissionResult', `‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                });
                
            } catch (error) {
                showResult('submissionResult', `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
