<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify Identity</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 1rem; }
        .status { padding: 1rem; margin: 1rem 0; border-radius: 6px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 0.75rem 1.5rem; margin: 0.5rem; border: none; border-radius: 6px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify Identity</h1>
    
    <div id="status-container"></div>
    
    <div>
        <button id="test-login" class="btn-primary">–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
        <button id="check-user" class="btn-success">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button id="test-logout" class="btn-danger">–í—ã–π—Ç–∏</button>
    </div>

    <div id="user-info" style="display:none;">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
        <pre id="user-data"></pre>
    </div>

    <script>
        const statusContainer = document.getElementById('status-container');
        const userInfo = document.getElementById('user-info');
        const userData = document.getElementById('user-data');

        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            statusContainer.appendChild(div);
            console.log(message);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        if (typeof window.netlifyIdentity === 'undefined') {
            addStatus('‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'error');
        } else {
            addStatus('‚úÖ Netlify Identity –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
        addStatus(`üåê –¢–µ–∫—É—â–∏–π URL: ${window.location.origin}`, 'info');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        if (window.netlifyIdentity) {
            addStatus('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Netlify Identity...', 'info');

            window.netlifyIdentity.on("init", user => {
                addStatus('‚úÖ Netlify Identity –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                if (user) {
                    addStatus(`üë§ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}`, 'success');
                    showUserInfo(user);
                } else {
                    addStatus('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'info');
                }
            });

            window.netlifyIdentity.on("login", user => {
                addStatus(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª: ${user.email}`, 'success');
                showUserInfo(user);
            });

            window.netlifyIdentity.on("logout", () => {
                addStatus('üëã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª', 'info');
                hideUserInfo();
            });

            window.netlifyIdentity.on("error", err => {
                addStatus(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            });

            window.netlifyIdentity.on("open", () => {
                addStatus('üîì –û–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–æ', 'info');
            });

            window.netlifyIdentity.on("close", () => {
                addStatus('üîí –û–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–æ', 'info');
            });

            try {
                window.netlifyIdentity.init();
            } catch (error) {
                addStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        function showUserInfo(user) {
            userInfo.style.display = 'block';
            userData.textContent = JSON.stringify(user, null, 2);
        }

        function hideUserInfo() {
            userInfo.style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('test-login').addEventListener('click', () => {
            addStatus('üîÑ –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞...', 'info');
            if (window.netlifyIdentity) {
                window.netlifyIdentity.open();
            } else {
                addStatus('‚ùå Netlify Identity –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        });

        document.getElementById('check-user').addEventListener('click', () => {
            addStatus('üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
            if (window.netlifyIdentity) {
                const user = window.netlifyIdentity.currentUser();
                if (user) {
                    addStatus(`‚úÖ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}`, 'success');
                    showUserInfo(user);
                } else {
                    addStatus('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'info');
                }
            }
        });

        document.getElementById('test-logout').addEventListener('click', () => {
            addStatus('üîÑ –í—ã—Ö–æ–¥–∏–º...', 'info');
            if (window.netlifyIdentity) {
                window.netlifyIdentity.logout();
            }
        });
    </script>
</body>
</html>