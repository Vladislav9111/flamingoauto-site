<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify Identity - Flamingo Auto</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        .check-panel {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .status-item {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #6c757d;
        }
        .status-success { border-left-color: #28a745; background: #d4edda; }
        .status-error { border-left-color: #dc3545; background: #f8d7da; }
        .status-warning { border-left-color: #ffc107; background: #fff3cd; }
        .btn {
            background: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
    </style>
</head>
<body>
    <main class="container check-panel">
        <div class="hero-header">
            <a class="logo" href="index.html">FLAMINGO AUTO</a>
        </div>

        <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify Identity</h1>
        <p style="color: #666; margin-bottom: 2rem;">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>

        <div id="status-container">
            <div class="status-item">
                <h3>‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º—É...</h3>
                <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <button class="btn" onclick="testLogin()">üîë –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
            <button class="btn btn-success" onclick="runFullCheck()">üîç –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</button>
            <a href="/admin/" class="btn">üöÄ –û—Ç–∫—Ä—ã—Ç—å CMS</a>
        </div>

        <div style="margin-top: 3rem; padding: 2rem; background: #e3f2fd; border-radius: 8px;">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</h3>
            <div style="color: #1976d2;">
                <p><strong>–ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong></p>
                <ol>
                    <li>–ó–∞–π–¥–∏—Ç–µ –≤ <a href="https://app.netlify.com" target="_blank">–ø–∞–Ω–µ–ª—å Netlify</a></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∞–π—Ç <code>flamingoauto</code></li>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <code>Site settings</code> ‚Üí <code>Identity</code></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <code>Enable Identity</code></li>
                    <li>–í —Ä–∞–∑–¥–µ–ª–µ <code>Services</code> –≤–∫–ª—é—á–∏—Ç–µ <code>Git Gateway</code></li>
                    <li>–í —Ä–∞–∑–¥–µ–ª–µ <code>Registration</code> –≤—ã–±–µ—Ä–∏—Ç–µ <code>Open</code> –∏–ª–∏ <code>Invite only</code></li>
                </ol>
            </div>
        </div>
    </main>

    <script>
        let statusContainer = document.getElementById('status-container');
        
        function addStatus(title, message, type = 'info') {
            const className = type === 'success' ? 'status-success' : 
                             type === 'error' ? 'status-error' : 
                             type === 'warning' ? 'status-warning' : 'status-item';
            
            statusContainer.innerHTML += `
                <div class="${className}">
                    <h3>${title}</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function clearStatus() {
            statusContainer.innerHTML = '';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Netlify Identity
        function checkNetlifyIdentity() {
            if (typeof window.netlifyIdentity === 'undefined') {
                addStatus('‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 
                    '–°–∫—Ä–∏–ø—Ç https://identity.netlify.com/v1/netlify-identity-widget.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.', 
                    'error');
                return false;
            }

            if (typeof window.netlifyIdentity.init !== 'function') {
                addStatus('‚ö†Ô∏è Netlify Identity –Ω–µ–ø–æ–ª–Ω—ã–π', 
                    '–û–±—ä–µ–∫—Ç netlifyIdentity –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 
                    'warning');
                return false;
            }

            addStatus('‚úÖ Netlify Identity –∑–∞–≥—Ä—É–∂–µ–Ω', 
                '–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 
                'success');
            return true;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∞–π—Ç–∞
        function checkSiteConfig() {
            const currentDomain = window.location.hostname;
            addStatus('üåê –î–æ–º–µ–Ω —Å–∞–π—Ç–∞', 
                `–¢–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω: ${currentDomain}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Netlify Identity –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞.`, 
                'info');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function checkCurrentUser() {
            if (!window.netlifyIdentity) return;

            try {
                const user = window.netlifyIdentity.currentUser();
                if (user) {
                    addStatus('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 
                        `Email: ${user.email}<br>ID: ${user.id}<br>–†–æ–ª–∏: ${user.app_metadata?.roles?.join(', ') || '–Ω–µ—Ç —Ä–æ–ª–µ–π'}`, 
                        'success');
                } else {
                    addStatus('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 
                        '–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ CMS –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 
                        'info');
                }
            } catch (error) {
                addStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 
                    `–û—à–∏–±–∫–∞: ${error.message}`, 
                    'error');
            }
        }

        // –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function testLogin() {
            if (!window.netlifyIdentity) {
                alert('Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                window.netlifyIdentity.open();
                addStatus('üîÑ –û–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–æ', 
                    '–ï—Å–ª–∏ –æ–∫–Ω–æ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ –ø–æ–ø–∞–ø–æ–≤', 
                    'info');
            } catch (error) {
                addStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 
                    `–û—à–∏–±–∫–∞: ${error.message}`, 
                    'error');
            }
        }

        // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        function runFullCheck() {
            clearStatus();
            addStatus('üîÑ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'info');
            
            setTimeout(() => {
                checkNetlifyIdentity();
                checkSiteConfig();
                checkCurrentUser();
                
                addStatus('‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 
                    '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—à–µ. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.', 
                    'success');
            }, 500);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on("init", user => {
                    clearStatus();
                    addStatus('üöÄ Netlify Identity –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 
                        user ? `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}` : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 
                        user ? 'success' : 'info');
                });

                window.netlifyIdentity.on("login", user => {
                    addStatus('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 
                        `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.email}!`, 
                        'success');
                });

                window.netlifyIdentity.on("logout", () => {
                    addStatus('‚ÑπÔ∏è –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 
                        '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 
                        'info');
                });

                window.netlifyIdentity.init();
            }

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(runFullCheck, 2000);
        });
    </script>
</body>
</html>