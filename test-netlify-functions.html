<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>–¢–µ—Å—Ç Netlify Functions</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
        .test-result { padding: 1rem; margin: 1rem 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 0.75rem 1.5rem; margin: 0.5rem; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        pre { background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç Netlify Functions</h1>
    
    <div class="test-result info">
        <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Netlify Functions</h3>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è.</p>
    </div>

    <div class="test-buttons">
        <button class="btn-primary" onclick="testConnection()">üîó –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
        <button class="btn-primary" onclick="checkAdminConfig()">‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
        <button class="btn-primary" onclick="testPasswordChange()">üîë –¢–µ—Å—Ç —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è</button>
        <button class="btn-secondary" onclick="clearResults()">üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
    </div>

    <div id="results"></div>

    <script>
        function addResult(type, title, content) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<h4>${title}</h4><div>${content}</div>`;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testConnection() {
            addResult('info', 'üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Ç–µ—Å—Ç–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏');
            
            try {
                const response = await fetch('/.netlify/functions/test-connection', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    addResult('success', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!', `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${data.message}</p>
                        <p><strong>–í—Ä–µ–º—è:</strong> ${data.timestamp}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `);
                } else {
                    addResult('error', '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                    `);
                }
            } catch (error) {
                addResult('error', '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏', `
                    <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                    <p>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
                    <ul>
                        <li>Netlify Functions –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</li>
                        <li>–°–∞–π—Ç –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Netlify</li>
                        <li>–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é</li>
                        <li>–§—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</li>
                    </ul>
                `);
            }
        }

        async function testPasswordChange() {
            addResult('info', 'üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è...', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è');
            
            try {
                const response = await fetch('/.netlify/functions/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        currentPassword: 'flamingo2024',
                        newPassword: 'test123456'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    addResult('success', '‚úÖ –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç!', `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${data.message}</p>
                        <p><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> ${data.note || '–ù–µ—Ç'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `);
                } else {
                    addResult('warning', '‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π', `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${data.error}</p>
                        <p>–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π.</p>
                    `);
                }
            } catch (error) {
                addResult('error', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è', `
                    <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                    <p>–≠—Ç–æ —Ç–∞ –∂–µ –æ—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –≤–∏–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ.</p>
                    <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ admin-fixed.html –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è.</p>
                `);
            }
        }

        async function checkAdminConfig() {
            addResult('info', 'üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∞–¥–º–∏–Ω–∞...', '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–æ–ª—è');
            
            try {
                const response = await fetch('/.netlify/functions/check-admin-config', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const config = data.config;
                    let configInfo = `
                        <p><strong>–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:</strong> ${config.adminPasswordSet ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
                        <p><strong>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:</strong> ${config.adminPasswordDefault ? '‚ö†Ô∏è –î–∞' : '‚úÖ –ù–µ—Ç'}</p>
                        <p><strong>GitHub —Ç–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω:</strong> ${config.githubTokenSet ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
                        <p><strong>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞:</strong> <code>${config.defaultPassword}</code></p>
                    `;
                    
                    if (config.adminPasswordDefault) {
                        configInfo += `
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 4px; margin-top: 1rem;">
                                <strong>‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è ADMIN_PASSWORD –≤ Netlify –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
                            </div>
                        `;
                    }
                    
                    addResult('success', '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞!', configInfo);
                } else {
                    addResult('error', '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${data.error}</p>
                    `);
                }
            } catch (error) {
                addResult('error', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', `
                    <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                    <p>–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>
                `);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            addResult('info', 'üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π.');
        });
    </script>
</body>
</html>