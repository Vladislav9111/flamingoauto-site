<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Debug Blog ‚Äî Flamingo Auto</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .debug-info h3 {
            margin: 0 0 0.5rem 0;
            color: #007bff;
        }
        .debug-info pre {
            background: #fff;
            padding: 0.5rem;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="hero-header">
                <a class="logo" href="index.html">FLAMINGO AUTO</a>
                <div class="lang-switch">
                    <a class="lang-btn" href="index.html">ET</a>
                    <a class="lang-btn" href="ru.html">RU</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container" style="max-width:900px; padding-top:2rem;">
        <h1>üîß Debug Blog</h1>
        <p>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–µ–π</p>

        <div class="debug-info">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ</h3>
            <div id="debug-info">–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
        </div>

        <div class="debug-info">
            <h3>üåê –¢–µ—Å—Ç —è–∑—ã–∫–æ–≤</h3>
            <button onclick="testLanguage('ru')" style="margin: 0.25rem; padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">–†—É—Å—Å–∫–∏–π</button>
            <button onclick="testLanguage('et')" style="margin: 0.25rem; padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">–≠—Å—Ç–æ–Ω—Å–∫–∏–π</button>
            <button onclick="testLanguage(null)" style="margin: 0.25rem; padding: 0.5rem 1rem; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">–í—Å–µ —è–∑—ã–∫–∏</button>
        </div>

        <div id="posts-container" style="margin-top:1rem;"></div>
    </main>

    <script src="blog-github.js"></script>
    <script>
        let allPosts = [];

        async function debugLoadPosts() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = 'üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å–∏...';

            try {
                // –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç—É—é —Ñ—É–Ω–∫—Ü–∏—é
                try {
                    const testResponse = await fetch('/.netlify/functions/test-posts');
                    if (testResponse.ok) {
                        const testData = await testResponse.json();
                        debugDiv.innerHTML += `<br>‚úÖ Test Function —Ä–∞–±–æ—Ç–∞–µ—Ç: ${testData.posts.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π`;
                    } else {
                        debugDiv.innerHTML += `<br>‚ùå Test Function: ${testResponse.status}`;
                    }
                } catch (error) {
                    debugDiv.innerHTML += `<br>‚ùå Test Function: ${error.message}`;
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é Netlify Function
                let netlifySuccess = false;
                try {
                    const netlifyResponse = await fetch('/.netlify/functions/get-posts');
                    if (netlifyResponse.ok) {
                        const netlifyPosts = await netlifyResponse.json();
                        netlifySuccess = true;
                        debugDiv.innerHTML += `<br>‚úÖ Get-Posts Function: ${netlifyPosts.length} —Å—Ç–∞—Ç–µ–π`;
                        allPosts = netlifyPosts;
                    } else {
                        const errorText = await netlifyResponse.text();
                        debugDiv.innerHTML += `<br>‚ùå Get-Posts Function: ${netlifyResponse.status} - ${errorText}`;
                    }
                } catch (error) {
                    debugDiv.innerHTML += `<br>‚ùå Get-Posts Function: ${error.message}`;
                }

                // –ï—Å–ª–∏ Netlify –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º GitHub API
                if (!netlifySuccess) {
                    try {
                        const posts = await window.BlogGitHub.loadPostsFromGitHub();
                        allPosts = posts;
                        debugDiv.innerHTML += `<br>‚úÖ GitHub API: ${posts.length} —Å—Ç–∞—Ç–µ–π`;
                    } catch (error) {
                        debugDiv.innerHTML += `<br>‚ùå GitHub API: ${error.message}`;
                    }
                }

                // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                if (allPosts.length === 0) {
                    debugDiv.innerHTML += '<br><br>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—å–∏ –Ω–∏ –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º';
                    allPosts = [
                        {
                            id: 'fallback-ru',
                            title: '–°–∫—É–ø–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ –¢–∞–ª–ª–∏–Ω–µ',
                            content: '–ú—ã –ø–æ–∫—É–ø–∞–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –ª—é–±—ã—Ö –º–∞—Ä–æ–∫ –∏ –≤ –ª—é–±–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –ë—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞, —á–µ—Å—Ç–Ω–∞—è —Ü–µ–Ω–∞, –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞.',
                            author: 'Flamingo Auto',
                            date: new Date().toISOString(),
                            locale: 'ru',
                            published: true
                        },
                        {
                            id: 'fallback-et',
                            title: 'Autode kokkuost Tallinnas',
                            content: 'Ostame autosid k√µikidest markidest ja igas seisukorras. Kiire hindamine, aus hind, kohene makse.',
                            author: 'Flamingo Auto',
                            date: new Date().toISOString(),
                            locale: 'et',
                            published: true
                        }
                    ];
                    debugDiv.innerHTML += '<br>üìù –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏';
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —è–∑—ã–∫–∞–º
                const langStats = {};
                allPosts.forEach(post => {
                    const locale = post.locale || 'all';
                    langStats[locale] = (langStats[locale] || 0) + 1;
                });

                debugDiv.innerHTML += '<br><br><strong>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è–∑—ã–∫–∞–º:</strong>';
                Object.entries(langStats).forEach(([lang, count]) => {
                    debugDiv.innerHTML += `<br>${lang}: ${count} —Å—Ç–∞—Ç–µ–π`;
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ç–µ–π
                debugDiv.innerHTML += '<br><br><strong>üìù –ü–µ—Ä–≤—ã–µ —Å—Ç–∞—Ç—å–∏:</strong>';
                allPosts.slice(0, 3).forEach(post => {
                    debugDiv.innerHTML += `<br>‚Ä¢ "${post.title}" (${post.locale})`;
                });

            } catch (error) {
                debugDiv.innerHTML += `<br>‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testLanguage(locale) {
            const container = document.getElementById('posts-container');
            container.innerHTML = `<p>üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —è–∑—ã–∫: ${locale || '–≤—Å–µ'}</p>`;

            try {
                await window.BlogGitHub.renderBlogPosts('posts-container', locale);
            } catch (error) {
                container.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            await debugLoadPosts();
            await testLanguage('ru'); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É—Å—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏
        });
    </script>
</body>
</html>