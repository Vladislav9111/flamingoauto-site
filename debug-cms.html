<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Netlify CMS - Flamingo Auto</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        .diagnostic-panel {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-item {
            background: #f8f9fa;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .success { background: #d4edda; color: #155724; border-left-color: #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left-color: #dc3545; }
        .warning { background: #fff3cd; color: #856404; border-left-color: #ffc107; }
        .info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
        .btn {
            background: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-size: 1rem;
        }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
    </style>
</head>
<body>
    <main class="container diagnostic-panel">
        <div class="hero-header">
            <a class="logo" href="index.html">FLAMINGO AUTO</a>
            <div class="lang-switch">
                <a class="lang-btn" href="index.html">ET</a>
                <a class="lang-btn" href="ru.html">RU</a>
            </div>
        </div>

        <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Netlify CMS</h1>
        <p style="color: #666; margin-bottom: 2rem;">–ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</p>

        <div class="test-item">
            <h3>üåê 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Netlify Identity</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ –≤–∏–¥–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Netlify</p>
            <button class="btn" onclick="testNetlifyIdentity()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <div id="identity-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>üîë 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
            <button class="btn" onclick="testAuth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
            <button class="btn btn-success" onclick="loginUser()">–í–æ–π—Ç–∏</button>
            <button class="btn btn-danger" onclick="logoutUser()">–í—ã–π—Ç–∏</button>
            <div id="auth-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>üìÅ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ /admin/</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è</p>
            <button class="btn" onclick="testAdminAccess()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø</button>
            <button class="btn btn-success" onclick="openAdmin()">–û—Ç–∫—Ä—ã—Ç—å /admin/</button>
            <div id="admin-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>‚öôÔ∏è 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CMS</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Netlify CMS</p>
            <button class="btn" onclick="testCMSConfig()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            <div id="config-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>üîó 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ Git Gateway</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Git Gateway –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
            <button class="btn" onclick="testGitGateway()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Git Gateway</button>
            <div id="git-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>üìù 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è –±–ª–æ–≥–∞</p>
            <button class="btn" onclick="testContentStructure()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
            <div id="content-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>üöÄ 7. –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <p>–ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
            <button class="btn btn-success" onclick="runFullDiagnosis()">–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
            <div id="full-result" class="test-result" style="display: none;"></div>
        </div>

        <div style="margin-top: 3rem; padding: 2rem; background: #e3f2fd; border-radius: 8px;">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h3>
            <div id="instructions" style="color: #1976d2;">
                <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º.</p>
            </div>
        </div>
    </main>

    <script>
        let diagnosticResults = {};

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞
        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = `test-result ${type}`;
            element.innerHTML = message;
            element.style.display = 'block';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ–±—â–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            diagnosticResults[elementId] = { type, message };
        }

        // 1. –¢–µ—Å—Ç Netlify Identity
        function testNetlifyIdentity() {
            try {
                if (typeof window.netlifyIdentity === 'undefined') {
                    showResult('identity-result', 'error', 
                        '‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω\n' +
                        '–ü—Ä–æ–±–ª–µ–º–∞: –°–∫—Ä–∏–ø—Ç https://identity.netlify.com/v1/netlify-identity-widget.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è\n' +
                        '–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Netlify'
                    );
                    return;
                }

                if (typeof window.netlifyIdentity.init === 'function') {
                    showResult('identity-result', 'success', 
                        '‚úÖ Netlify Identity –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ\n' +
                        '–í–µ—Ä—Å–∏—è: ' + (window.netlifyIdentity.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞') + '\n' +
                        '–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ'
                    );
                } else {
                    showResult('identity-result', 'warning', 
                        '‚ö†Ô∏è Netlify Identity –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\n' +
                        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É'
                    );
                }
            } catch (error) {
                showResult('identity-result', 'error', 
                    '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Netlify Identity:\n' + error.message
                );
            }
        }

        // 2. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function testAuth() {
            try {
                if (!window.netlifyIdentity) {
                    showResult('auth-result', 'error', '‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }

                const user = window.netlifyIdentity.currentUser();
                if (user) {
                    showResult('auth-result', 'success', 
                        '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω\n' +
                        'Email: ' + user.email + '\n' +
                        'ID: ' + user.id + '\n' +
                        '–†–æ–ª–∏: ' + (user.app_metadata?.roles?.join(', ') || '–Ω–µ—Ç —Ä–æ–ª–µ–π')
                    );
                } else {
                    showResult('auth-result', 'warning', 
                        '‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω\n' +
                        '–î–ª—è —Ä–∞–±–æ—Ç—ã —Å CMS –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è'
                    );
                }
            } catch (error) {
                showResult('auth-result', 'error', 
                    '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:\n' + error.message
                );
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function loginUser() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.open();
            } else {
                alert('Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
        }

        function logoutUser() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.logout();
            } else {
                alert('Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
        }

        // 3. –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ
        async function testAdminAccess() {
            try {
                const response = await fetch('/admin/', { method: 'HEAD' });
                if (response.ok) {
                    showResult('admin-result', 'success', 
                        '‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ /admin/ –¥–æ—Å—Ç—É–ø–Ω–∞\n' +
                        '–°—Ç–∞—Ç—É—Å: ' + response.status + '\n' +
                        '–ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å CMS'
                    );
                } else {
                    showResult('admin-result', 'error', 
                        '‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ /admin/ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\n' +
                        '–°—Ç–∞—Ç—É—Å: ' + response.status + '\n' +
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Netlify'
                    );
                }
            } catch (error) {
                showResult('admin-result', 'error', 
                    '‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ /admin/:\n' + error.message
                );
            }
        }

        function openAdmin() {
            window.open('/admin/', '_blank');
        }

        // 4. –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CMS
        async function testCMSConfig() {
            try {
                const configResponse = await fetch('/admin/config.yml');
                if (configResponse.ok) {
                    const configText = await configResponse.text();
                    const hasBackend = configText.includes('git-gateway');
                    const hasCollections = configText.includes('collections:');
                    
                    if (hasBackend && hasCollections) {
                        showResult('config-result', 'success', 
                            '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CMS –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞\n' +
                            'Backend: git-gateway –Ω–∞–π–¥–µ–Ω\n' +
                            'Collections: –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã\n' +
                            '–†–∞–∑–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞: ' + configText.length + ' —Å–∏–º–≤–æ–ª–æ–≤'
                        );
                    } else {
                        showResult('config-result', 'warning', 
                            '‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è\n' +
                            'Backend: ' + (hasBackend ? '‚úÖ' : '‚ùå') + '\n' +
                            'Collections: ' + (hasCollections ? '‚úÖ' : '‚ùå')
                        );
                    }
                } else {
                    showResult('config-result', 'error', 
                        '‚ùå –§–∞–π–ª config.yml –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω\n' +
                        '–°—Ç–∞—Ç—É—Å: ' + configResponse.status
                    );
                }
            } catch (error) {
                showResult('config-result', 'error', 
                    '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:\n' + error.message
                );
            }
        }

        // 5. –¢–µ—Å—Ç Git Gateway
        async function testGitGateway() {
            try {
                if (!window.netlifyIdentity) {
                    showResult('git-result', 'error', '‚ùå Netlify Identity –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }

                const user = window.netlifyIdentity.currentUser();
                if (!user) {
                    showResult('git-result', 'warning', 
                        '‚ö†Ô∏è –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Git Gateway –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\n' +
                        '–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç'
                    );
                    return;
                }

                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
                const token = await user.jwt();
                if (token) {
                    showResult('git-result', 'success', 
                        '‚úÖ Git Gateway –¥–æ—Å—Ç—É–ø–µ–Ω\n' +
                        '–¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω: ' + token.substring(0, 20) + '...\n' +
                        '–ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤ GitHub'
                    );
                } else {
                    showResult('git-result', 'error', 
                        '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω Git Gateway\n' +
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏ Netlify'
                    );
                }
            } catch (error) {
                showResult('git-result', 'error', 
                    '‚ùå –û—à–∏–±–∫–∞ Git Gateway:\n' + error.message
                );
            }
        }

        // 6. –¢–µ—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function testContentStructure() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ content/blog
                const response = await fetch('/content/blog/', { method: 'HEAD' });
                
                showResult('content-result', 'info', 
                    '‚ÑπÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n' +
                    '–ü–∞–ø–∫–∞ /content/blog/: ' + (response.ok ? '‚úÖ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω–∞') + '\n' +
                    '–°—Ç–∞—Ç—É—Å: ' + response.status + '\n' +
                    '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏'
                );
            } catch (error) {
                showResult('content-result', 'warning', 
                    '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:\n' + error.message + '\n' +
                    '–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∞–π—Ç–æ–≤'
                );
            }
        }

        // 7. –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        async function runFullDiagnosis() {
            showResult('full-result', 'info', 'üîÑ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã
            testNetlifyIdentity();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testAuth();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAdminAccess();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testCMSConfig();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGitGateway();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testContentStructure();
            
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            setTimeout(() => {
                analyzeResults();
            }, 1000);
        }

        // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        function analyzeResults() {
            const errors = Object.values(diagnosticResults).filter(r => r.type === 'error').length;
            const warnings = Object.values(diagnosticResults).filter(r => r.type === 'warning').length;
            const successes = Object.values(diagnosticResults).filter(r => r.type === 'success').length;

            let summary = `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:\n`;
            summary += `‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successes}\n`;
            summary += `‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${warnings}\n`;
            summary += `‚ùå –û—à–∏–±–∫–∏: ${errors}\n\n`;

            if (errors === 0 && warnings <= 1) {
                summary += 'üéâ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!';
                showResult('full-result', 'success', summary);
                updateInstructions('success');
            } else if (errors <= 1) {
                summary += '‚ö†Ô∏è –ï—Å—Ç—å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã';
                showResult('full-result', 'warning', summary);
                updateInstructions('warning');
            } else {
                summary += '‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã';
                showResult('full-result', 'error', summary);
                updateInstructions('error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
        function updateInstructions(status) {
            const instructions = document.getElementById('instructions');
            
            if (status === 'success') {
                instructions.innerHTML = `
                    <h4>‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!</h4>
                    <p>Netlify CMS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –í—ã –º–æ–∂–µ—Ç–µ:</p>
                    <ul>
                        <li>–û—Ç–∫—Ä—ã—Ç—å <a href="/admin/" target="_blank">Netlify CMS</a></li>
                        <li>–°–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å–∏</li>
                        <li>–ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤ GitHub</li>
                    </ul>
                `;
            } else if (status === 'warning') {
                instructions.innerHTML = `
                    <h4>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ</h4>
                    <p>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</p>
                    <ul>
                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ GitHub</li>
                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git Gateway –≤ –ø–∞–Ω–µ–ª–∏ Netlify</li>
                        <li>–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É</li>
                    </ul>
                `;
            } else {
                instructions.innerHTML = `
                    <h4>‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h4>
                    <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</p>
                    <ol>
                        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Netlify:</strong>
                            <ul>
                                <li>Identity –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω</li>
                                <li>Git Gateway –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>
                                <li>–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω</li>
                            </ul>
                        </li>
                        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:</strong>
                            <ul>
                                <li>/admin/index.html –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å</li>
                                <li>/admin/config.yml –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º</li>
                            </ul>
                        </li>
                        <li><strong>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:</strong>
                            <ul>
                                <li><a href="https://docs.netlify.com/visitor-access/identity/" target="_blank">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Netlify Identity</a></li>
                                <li><a href="https://docs.netlify.com/visitor-access/git-gateway/" target="_blank">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git Gateway</a></li>
                            </ul>
                        </li>
                    </ol>
                `;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.init();
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                window.netlifyIdentity.on("login", user => {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:", user.email);
                    testAuth(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                });

                window.netlifyIdentity.on("logout", () => {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª");
                    testAuth(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                });
            }
        });
    </script>
</body>
</html>